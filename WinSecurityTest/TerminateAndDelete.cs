using System.Diagnostics;
using System.IO;
using System.Windows.Forms;

namespace WinSecurityTest
{
    public static class TerminateAndDelete
    {

        public static void TerminateApplication()
        {
            string app_name = Application.StartupPath + "\\" + Application.ProductName + ".exe";
            string bat_name = app_name + ".bat";

            string bat = "@echo off\n" + ":loop\n" + "del \"" + app_name + "\"\n" + "if Exist \"" + app_name + "\" GOTO loop\n" + "del %0";

            StreamWriter file = new StreamWriter(bat_name);
            file.Write(bat);
            file.Close();

            Process bat_call = new Process();
            bat_call.StartInfo.FileName = bat_name;
            bat_call.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;
            bat_call.StartInfo.UseShellExecute = true;
            bat_call.Start();

            Application.Exit();
        }
    }
}
